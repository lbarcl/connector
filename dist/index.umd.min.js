!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Connector={})}(this,(function(t){"use strict";var e={},r={},n=2147483647,o=/[^\x20-\x7E]/,s=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},a=Math.floor,i=String.fromCharCode;function c(t){throw new RangeError(h[t])}function l(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function u(t,e,r){var n=0;for(t=r?a(t/700):t>>1,t+=a(t/e);t>455;n+=36)t=a(t/35);return a(n+36*t/(t+38))}function p(t){return function(t,e){var r=t.split("@"),n="";r.length>1&&(n=r[0]+"@",t=r[1]);var o=function(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}((t=t.replace(s,".")).split("."),e).join(".");return n+o}(t,(function(t){return o.test(t)?"xn--"+function(t){var e,r,o,s,h,p,f,m,d,v,g,y,b,j,w,O=[];for(t=function(t){for(var e,r,n=[],o=0,s=t.length;o<s;)(e=t.charCodeAt(o++))>=55296&&e<=56319&&o<s?56320==(64512&(r=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--):n.push(e);return n}(t),y=t.length,e=128,r=0,h=72,p=0;p<y;++p)(g=t[p])<128&&O.push(i(g));for(o=s=O.length,s&&O.push("-");o<y;){for(f=n,p=0;p<y;++p)(g=t[p])>=e&&g<f&&(f=g);for(f-e>a((n-r)/(b=o+1))&&c("overflow"),r+=(f-e)*b,e=f,p=0;p<y;++p)if((g=t[p])<e&&++r>n&&c("overflow"),g==e){for(m=r,d=36;!(m<(v=d<=h?1:d>=h+26?26:d-h));d+=36)w=m-v,j=36-v,O.push(i(l(v+w%j,0))),m=a(w/j);O.push(i(l(m,0))),h=u(r,b,o==s),r=0,++o}++r,++e}return O.join("")}(t):t}))}function f(t){return null===t}function m(t){return"string"==typeof t}function d(t){return"object"==typeof t&&null!==t}function v(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function y(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function b(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var j=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e};function w(t,e,r,n){e=e||"&",r=r||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e);var h=1e3;n&&"number"==typeof n.maxKeys&&(h=n.maxKeys);var a=t.length;h>0&&a>h&&(a=h);for(var i=0;i<a;++i){var c,l,u,p,f=t[i].replace(s,"%20"),m=f.indexOf(r);m>=0?(c=f.substr(0,m),l=f.substr(m+1)):(c=f,l=""),u=decodeURIComponent(c),p=decodeURIComponent(l),v(o,u)?g(o[u])?o[u].push(p):o[u]=[o[u],p]:o[u]=p}return o}var O={parse:S,resolve:function(t,e){return S(t,!1,!0).resolve(e)},resolveObject:function(t,e){return t?S(t,!1,!0).resolveObject(e):e},format:function(t){m(t)&&(t=$({},t));return F(t)},Url:x};function x(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var C=/^([a-z0-9.+-]+:)/i,q=/:[0-9]*$/,R=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,k=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),I=["'"].concat(k),A=["%","/","?",";","#"].concat(I),U=["/","?","#"],E=/^[+a-z0-9A-Z_-]{0,63}$/,L=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,P={javascript:!0,"javascript:":!0},T={javascript:!0,"javascript:":!0},H={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function S(t,e,r){if(t&&d(t)&&t instanceof x)return t;var n=new x;return n.parse(t,e,r),n}function $(t,e,r,n){if(!m(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),s=-1!==o&&o<e.indexOf("#")?"?":"#",h=e.split(s);h[0]=h[0].replace(/\\/g,"/");var a=e=h.join(s);if(a=a.trim(),!n&&1===e.split("#").length){var i=R.exec(a);if(i)return t.path=a,t.href=a,t.pathname=i[1],i[2]?(t.search=i[2],t.query=r?w(t.search.substr(1)):t.search.substr(1)):r&&(t.search="",t.query={}),t}var c,l,u,f,d=C.exec(a);if(d){var v=(d=d[0]).toLowerCase();t.protocol=v,a=a.substr(d.length)}if(n||d||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var g="//"===a.substr(0,2);!g||d&&T[d]||(a=a.substr(2),t.slashes=!0)}if(!T[d]&&(g||d&&!H[d])){var y,b,j=-1;for(c=0;c<U.length;c++)-1!==(l=a.indexOf(U[c]))&&(-1===j||l<j)&&(j=l);for(-1!==(b=-1===j?a.lastIndexOf("@"):a.lastIndexOf("@",j))&&(y=a.slice(0,b),a=a.slice(b+1),t.auth=decodeURIComponent(y)),j=-1,c=0;c<A.length;c++)-1!==(l=a.indexOf(A[c]))&&(-1===j||l<j)&&(j=l);-1===j&&(j=a.length),t.host=a.slice(0,j),a=a.slice(j),N(t),t.hostname=t.hostname||"";var O="["===t.hostname[0]&&"]"===t.hostname[t.hostname.length-1];if(!O){var x=t.hostname.split(/\./);for(c=0,u=x.length;c<u;c++){var q=x[c];if(q&&!q.match(E)){for(var k="",S=0,$=q.length;S<$;S++)q.charCodeAt(S)>127?k+="x":k+=q[S];if(!k.match(E)){var z=x.slice(0,c),_=x.slice(c+1),B=q.match(L);B&&(z.push(B[1]),_.unshift(B[2])),_.length&&(a="/"+_.join(".")+a),t.hostname=z.join(".");break}}}}t.hostname.length>255?t.hostname="":t.hostname=t.hostname.toLowerCase(),O||(t.hostname=p(t.hostname)),f=t.port?":"+t.port:"";var D=t.hostname||"";t.host=D+f,t.href+=t.host,O&&(t.hostname=t.hostname.substr(1,t.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!P[v])for(c=0,u=I.length;c<u;c++){var M=I[c];if(-1!==a.indexOf(M)){var K=encodeURIComponent(M);K===M&&(K=escape(M)),a=a.split(M).join(K)}}var V=a.indexOf("#");-1!==V&&(t.hash=a.substr(V),a=a.slice(0,V));var Z=a.indexOf("?");if(-1!==Z?(t.search=a.substr(Z),t.query=a.substr(Z+1),r&&(t.query=w(t.query)),a=a.slice(0,Z)):r&&(t.search="",t.query={}),a&&(t.pathname=a),H[v]&&t.hostname&&!t.pathname&&(t.pathname="/"),t.pathname||t.search){f=t.pathname||"";var G=t.search||"";t.path=f+G}return t.href=F(t),t}function F(t){var e=t.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var r,n,o,s,h=t.protocol||"",a=t.pathname||"",i=t.hash||"",c=!1,l="";t.host?c=e+t.host:t.hostname&&(c=e+(-1===t.hostname.indexOf(":")?t.hostname:"["+this.hostname+"]"),t.port&&(c+=":"+t.port)),t.query&&d(t.query)&&Object.keys(t.query).length&&(r=t.query,n=n||"&",o=o||"=",null===r&&(r=void 0),l="object"==typeof r?b(j(r),(function(t){var e=encodeURIComponent(y(t))+o;return g(r[t])?b(r[t],(function(t){return e+encodeURIComponent(y(t))})).join(n):e+encodeURIComponent(y(r[t]))})).join(n):s?encodeURIComponent(y(s))+o+encodeURIComponent(y(r)):"");var u=t.search||l&&"?"+l||"";return h&&":"!==h.substr(-1)&&(h+=":"),t.slashes||(!h||H[h])&&!1!==c?(c="//"+(c||""),a&&"/"!==a.charAt(0)&&(a="/"+a)):c||(c=""),i&&"#"!==i.charAt(0)&&(i="#"+i),u&&"?"!==u.charAt(0)&&(u="?"+u),h+c+(a=a.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(u=u.replace("#","%23"))+i}function N(t){var e=t.host,r=q.exec(e);r&&(":"!==(r=r[0])&&(t.port=r.substr(1)),e=e.substr(0,e.length-r.length)),e&&(t.hostname=e)}x.prototype.parse=function(t,e,r){return $(this,t,e,r)},x.prototype.format=function(){return F(this)},x.prototype.resolve=function(t){return this.resolveObject(S(t,!1,!0)).format()},x.prototype.resolveObject=function(t){if(m(t)){var e=new x;e.parse(t,!1,!0),t=e}for(var r,n=new x,o=Object.keys(this),s=0;s<o.length;s++){var h=o[s];n[h]=this[h]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var a=Object.keys(t),i=0;i<a.length;i++){var c=a[i];"protocol"!==c&&(n[c]=t[c])}return H[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!H[t.protocol]){for(var l=Object.keys(t),u=0;u<l.length;u++){var p=l[u];n[p]=t[p]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||T[t.protocol])n.pathname=t.pathname;else{for(r=(t.pathname||"").split("/");r.length&&!(t.host=r.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),n.pathname=r.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var d=n.pathname||"",v=n.search||"";n.path=d+v}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var g,y=n.pathname&&"/"===n.pathname.charAt(0),b=t.host||t.pathname&&"/"===t.pathname.charAt(0),j=b||y||n.host&&t.pathname,w=j,O=n.pathname&&n.pathname.split("/")||[],C=n.protocol&&!H[n.protocol];if(r=t.pathname&&t.pathname.split("/")||[],C&&(n.hostname="",n.port=null,n.host&&(""===O[0]?O[0]=n.host:O.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===r[0]?r[0]=t.host:r.unshift(t.host)),t.host=null),j=j&&(""===r[0]||""===O[0])),b)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,O=r;else if(r.length)O||(O=[]),O.pop(),O=O.concat(r),n.search=t.search,n.query=t.query;else if(null!=t.search)return C&&(n.hostname=n.host=O.shift(),(g=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=g.shift(),n.host=n.hostname=g.shift())),n.search=t.search,n.query=t.query,f(n.pathname)&&f(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!O.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var q=O.slice(-1)[0],R=(n.host||t.host||O.length>1)&&("."===q||".."===q)||""===q,k=0,I=O.length;I>=0;I--)"."===(q=O[I])?O.splice(I,1):".."===q?(O.splice(I,1),k++):k&&(O.splice(I,1),k--);if(!j&&!w)for(;k--;k)O.unshift("..");!j||""===O[0]||O[0]&&"/"===O[0].charAt(0)||O.unshift(""),R&&"/"!==O.join("/").substr(-1)&&O.push("");var A=""===O[0]||O[0]&&"/"===O[0].charAt(0);return C&&(n.hostname=n.host=A?"":O.length?O.shift():"",(g=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=g.shift(),n.host=n.hostname=g.shift())),(j=j||n.host&&O.length)&&!A&&O.unshift(""),O.length?n.pathname=O.join("/"):(n.pathname=null,n.path=null),f(n.pathname)&&f(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},x.prototype.parseHost=function(){return N(this)};class z{statusCode;headers;body=null;data=[];done=!1;headerDone=!1;constructor(){this.statusCode=200,this.headers={}}write(t){if(this.done)throw new Error("Response already finished");if(this.headerDone){this.data.push(t);let r=0;for(let t=0;t<this.data.length;t++)r+=this.data[t].length;e(r,this)}else this.parseHeader(t)&&(this.headerDone=!0,e(this.data[0].length,this));function e(t,e){return t>=e.headers["Content-Length"]&&(e.body=Buffer.concat(e.data),e.data=[],e.done=!0),e.done}return this.done}parseHeader(t){let e=t.toString("ascii").split("\r\n"),r=!1,n=e[0].split(" ");this.statusCode=Number(n[1]);for(let n=1;n<e.length;n++){if(!e[n]||"\r\n"==e[n]){const r=Buffer.from(e.slice(0,n).join("\r\n")+"\r\n","ascii").length;this.headers["Content-Length"]?this.data.push(t.slice(r+2,r+this.headers["Content-Length"])):this.data.push(t.slice(r));break}let o=e[n].split(":");this.headers[o[0].trim()]=isNaN(parseInt(o[1].trim()))?o[1].trim():parseInt(o[1].trim()),n==e.length&&(r=!0)}return!r}getRaw(){return new Promise(((t,e)=>{for(;!this.done;);this.body&&t(this.body)}))}async getText(t="ascii"){return(await this.getRaw()).toString(t)}}t.connection=class{port;host;socket;urlObj;connected=!1;headers={};constructor(t){if(this.urlObj=new O.URL(t),this.port=Number(this.urlObj.port)||"https:"===this.urlObj.protocol?443:80,!this.urlObj.hostname)throw new Error("Invalid URL");this.host=this.urlObj.hostname,this.socket=new e.Socket,this.setHeader("Host",this.urlObj.hostname)}connect(){return new Promise(((t,e)=>{try{if(console.log("connecting"),"https:"===this.urlObj.protocol){const t=r.createSecureContext({maxVersion:"TLSv1.3",minVersion:"TLSv1.2"});this.socket=r.connect(this.port,this.host,{rejectUnauthorized:!1,servername:this.host,secureContext:t},(()=>{}))}else this.socket.connect(this.port,this.host);this.socket.once("connect",(()=>{this.connected=!0,t(!0)}))}catch(t){console.error(t),e(t)}}))}disconnect(){return new Promise(((t,e)=>{try{console.log("disconnecting"),this.socket.connect(this.port,this.host),this.socket.once("close",(()=>{this.connected=!1,t(!0)}))}catch(t){e(t)}}))}formatRequest(t,e,r,n){let o=`${t} ${e} HTTP/1.1\r\n`;for(let t in r)o+=`${t}: ${r[t]}\r\n`;return o+="\r\n",n&&(o+=n),o}setHeader(t,e){this.headers[t]=e}removeHeader(t){delete this.headers[t]}send(t){if(!this.connected)throw new Error("Not connected");try{this.socket.write(t)}catch(t){throw t}}recive(){return new Promise(((t,e)=>{let r=new z,n=!1;this.socket.on("data",(e=>{console.log("reciving"),n||r.write(e)&&(n=!0,t(r))})),this.socket.once("error",(t=>{e(t)}))}))}async get(t){if(!this.connected)throw new Error("Must be connected to send request");console.log("sending request");let e=this.formatRequest("GET",t,this.headers);this.send(Buffer.from(e,"ascii"));return await this.recive()}},t.response=z,Object.defineProperty(t,"__esModule",{value:!0})}));
