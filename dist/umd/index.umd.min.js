!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("net"),require("tls"),require("url"),require("events")):"function"==typeof define&&define.amd?define(["exports","net","tls","url","events"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).coronncet={},t.net,t.tls,t.url,t.EventEmitter)}(this,(function(t,e,s,r,i){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(e),h=n(s),c=n(r),d=n(i);function u(t,e,s,r){return new(s||(s=Promise))((function(i,n){function o(t){try{c(r.next(t))}catch(t){n(t)}}function h(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,h)}c((r=r.apply(t,e||[])).next())}))}class a{constructor(t){this.body=null,this.data=[],this.done=!1,this.headerDone=!1,this.statusCode=200,this.headers={},t&&(this.method=t)}write(t){if(this.done)throw new Error("Response already finished");if(this.headerDone){this.data.push(t);let s=0;for(let t=0;t<this.data.length;t++)s+=this.data[t].length;e(s,this)}else this.parseHeader(t)&&(this.headerDone=!0,"HEAD"==this.method?this.done=!0:e(this.data[0].length,this));function e(t,e){return t>=e.headers["Content-Length"]&&(e.body=Buffer.concat(e.data),e.data=[],e.done=!0),e.done}return this.done}parseHeader(t){let e=t.toString("ascii").split("\r\n"),s=!1,r=e[0].split(" ");this.statusCode=Number(r[1]);for(let r=1;r<e.length;r++){if(!e[r]||"\r\n"==e[r]){const s=Buffer.from(e.slice(0,r).join("\r\n")+"\r\n","ascii").length;this.headers["Content-Length"]?this.data.push(t.slice(s+2,s+this.headers["Content-Length"])):this.data.push(t.slice(s));break}let i=e[r].split(":");this.headers[i[0].trim()]=isNaN(parseInt(i[1].trim()))?i[1].trim():parseInt(i[1].trim()),r==e.length&&(s=!0)}return!s}getRaw(){if(this.body&&this.done)return this.body;throw"HEAD"==this.method?new Error("This function is not supported in HEAD method"):new Error("Response not finished")}getText(t="ascii"){return this.getRaw().toString(t)}}class f extends d.default{constructor(t,e){if(super(),this.connected=!1,this.headers={},this.timeout=5e3,this.urlObj=new c.default.URL(t),this.port=Number(this.urlObj.port)||"https:"===this.urlObj.protocol?443:80,!this.urlObj.hostname)throw new Error("Invalid URL");this.host=this.urlObj.hostname,this.socket=new o.default.Socket,this.setHeader("Host",this.urlObj.hostname),this.socket.on("error",(t=>{throw t})),this.socket.on("close",(()=>this.connected=!1)),e&&(this.timeout=e.timeout||this.timeout)}connect(){return new Promise(((t,e)=>{try{if(this.connected&&t(!0),"https:"===this.urlObj.protocol){const t=h.default.createSecureContext({maxVersion:"TLSv1.3",minVersion:"TLSv1.2"});this.socket=h.default.connect(this.port,this.host,{rejectUnauthorized:!1,servername:this.host,secureContext:t},(()=>{}))}else this.socket.connect(this.port,this.host);this.socket.once("connect",(()=>{this.connected=!0,t(!0)}))}catch(t){console.error(t),e(t)}}))}disconnect(){return new Promise(((t,e)=>{try{this.connected&&t(!0),this.socket.connect(this.port,this.host),this.socket.once("close",(()=>{this.connected=!1,t(!0)}))}catch(t){e(t)}}))}formatRequest(t,e,s,r){let i=`${t} ${e} HTTP/1.1\r\n`;for(let t in s)i+=`${t}: ${s[t]}\r\n`;return i+="\r\n",r&&(i+=r),i}setHeader(t,e){this.headers[t]=e}removeHeader(t){delete this.headers[t]}send(t){if(!this.connected)throw new Error("Not connected");try{this.socket.write(t)}catch(t){throw t}}recive(t){return new Promise(((e,s)=>{let r=new a(t);this.socket.on("data",(t=>{this.emit("data",t),r.write(t)&&(this.socket.removeAllListeners("data"),e(r))})),setTimeout((()=>{r.headers["Content-Length"]||e(r)}),this.timeout)}))}}t.HTTPClient=class extends f{constructor(t,e){super(t,e)}get(t){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let e=this.formatRequest("GET",t,this.headers);this.send(Buffer.from(e,"ascii"));return yield this.recive("GET")}))}post(t,e){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("POST",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("POST")}))}put(t,e){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("PUT",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("PUT")}))}delete(t,e){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("DELETE",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("DELETE")}))}head(t){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let e=this.formatRequest("HEAD",t,this.headers);this.send(Buffer.from(e,"ascii"));return yield this.recive("HEAD")}))}patch(t,e){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("PATCH",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("PATCH")}))}},t.HTTPConnection=f,t.response=a,Object.defineProperty(t,"__esModule",{value:!0})}));
