!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("net"),require("tls"),require("url")):"function"==typeof define&&define.amd?define(["exports","net","tls","url"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Connector={},t.net,t.tls,t.url)}(this,(function(t,e,s,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=r(e),o=r(s),h=r(n);function c(t,e,s,n){return new(s||(s=Promise))((function(r,i){function o(t){try{c(n.next(t))}catch(t){i(t)}}function h(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,h)}c((n=n.apply(t,e||[])).next())}))}class d{constructor(t){this.body=null,this.data=[],this.done=!1,this.headerDone=!1,this.statusCode=200,this.headers={},t&&(this.method=t)}write(t){if(this.done)throw new Error("Response already finished");if(this.headerDone){this.data.push(t);let s=0;for(let t=0;t<this.data.length;t++)s+=this.data[t].length;e(s,this)}else this.parseHeader(t)&&(this.headerDone=!0,"HEAD"==this.method?this.done=!0:e(this.data[0].length,this));function e(t,e){return t>=e.headers["Content-Length"]&&(e.body=Buffer.concat(e.data),e.data=[],e.done=!0),e.done}return this.done}parseHeader(t){let e=t.toString("ascii").split("\r\n"),s=!1,n=e[0].split(" ");this.statusCode=Number(n[1]);for(let n=1;n<e.length;n++){if(!e[n]||"\r\n"==e[n]){const s=Buffer.from(e.slice(0,n).join("\r\n")+"\r\n","ascii").length;this.headers["Content-Length"]?this.data.push(t.slice(s+2,s+this.headers["Content-Length"])):this.data.push(t.slice(s));break}let r=e[n].split(":");this.headers[r[0].trim()]=isNaN(parseInt(r[1].trim()))?r[1].trim():parseInt(r[1].trim()),n==e.length&&(s=!0)}return!s}getRaw(){if(this.body&&this.done)return this.body;throw"HEAD"==this.method?new Error("This function is not supported in HEAD method"):new Error("Response not finished")}getText(t="ascii"){return this.getRaw().toString(t)}}class u{constructor(t,e){if(this.connected=!1,this.headers={},this.timeout=5e3,this.urlObj=new h.default.URL(t),this.port=Number(this.urlObj.port)||"https:"===this.urlObj.protocol?443:80,!this.urlObj.hostname)throw new Error("Invalid URL");this.host=this.urlObj.hostname,this.socket=new i.default.Socket,this.setHeader("Host",this.urlObj.hostname),this.socket.on("error",(t=>{throw t})),this.socket.on("close",(()=>this.connected=!1)),e&&(this.timeout=e.timeout||this.timeout)}connect(){return new Promise(((t,e)=>{try{if(this.connected&&t(!0),"https:"===this.urlObj.protocol){const t=o.default.createSecureContext({maxVersion:"TLSv1.3",minVersion:"TLSv1.2"});this.socket=o.default.connect(this.port,this.host,{rejectUnauthorized:!1,servername:this.host,secureContext:t},(()=>{}))}else this.socket.connect(this.port,this.host);this.socket.once("connect",(()=>{this.connected=!0,t(!0)}))}catch(t){console.error(t),e(t)}}))}disconnect(){return new Promise(((t,e)=>{try{this.connected&&t(!0),this.socket.connect(this.port,this.host),this.socket.once("close",(()=>{this.connected=!1,t(!0)}))}catch(t){e(t)}}))}formatRequest(t,e,s,n){let r=`${t} ${e} HTTP/1.1\r\n`;for(let t in s)r+=`${t}: ${s[t]}\r\n`;return r+="\r\n",n&&(r+=n),r}setHeader(t,e){this.headers[t]=e}removeHeader(t){delete this.headers[t]}send(t){if(!this.connected)throw new Error("Not connected");try{this.socket.write(t)}catch(t){throw t}}recive(t){return new Promise(((e,s)=>{let n=new d(t),r=!1;this.socket.on("data",(t=>{r||n.write(t)&&(r=!0,e(n))})),setTimeout((()=>{n.headers["Content-Length"]||e(n)}),this.timeout)}))}}t.HTTPClient=class extends u{constructor(t,e){super(t,e)}get(t){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");console.log("sending request");let e=this.formatRequest("GET",t,this.headers);this.send(Buffer.from(e,"ascii"));return yield this.recive("GET")}))}post(t,e){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("POST",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("POST")}))}put(t,e){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("PUT",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("PUT")}))}delete(t,e){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("DELETE",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("DELETE")}))}head(t){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let e=this.formatRequest("HEAD",t,this.headers);this.send(Buffer.from(e,"ascii"));return yield this.recive("HEAD")}))}patch(t,e){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("PATCH",t,this.headers,e);this.send(Buffer.from(s,"ascii"));return yield this.recive("PATCH")}))}},t.HTTPConnection=u,t.response=d,Object.defineProperty(t,"__esModule",{value:!0})}));
