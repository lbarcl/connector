!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("net"),require("tls"),require("url"),require("events")):"function"==typeof define&&define.amd?define(["exports","net","tls","url","events"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).coronncet={},e.net,e.tls,e.url,e.EventEmitter)}(this,(function(e,t,s,r,n){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=i(t),h=i(s),c=i(r),d=i(n);function u(e,t,s,r){return new(s||(s=Promise))((function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function h(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,h)}c((r=r.apply(e,t||[])).next())}))}class a{constructor(e){this.body=null,this.data=[],this.done=!1,this.headerDone=!1,this.statusCode=200,this.headers={},e&&(this.method=e)}write(e){if(this.done)throw new Error("Response already finished");if(this.headerDone){this.data.push(e);let s=0;for(let e=0;e<this.data.length;e++)s+=this.data[e].length;t(s,this)}else this.parseHeader(e)&&(this.headerDone=!0,"HEAD"==this.method?this.done=!0:t(this.data[0].length,this));function t(e,t){return e>=t.headers["Content-Length"]&&(t.body=Buffer.concat(t.data),t.data=[],t.done=!0),t.done}return this.done}parseHeader(e){let t=e.toString("ascii").split("\r\n"),s=!1,r=t[0].split(" ");this.statusCode=Number(r[1]);for(let r=1;r<t.length;r++){if(!t[r]||"\r\n"==t[r]){const s=Buffer.from(t.slice(0,r).join("\r\n")+"\r\n","ascii").length;this.headers["Content-Length"]?this.data.push(e.slice(s+2,s+this.headers["Content-Length"])):this.data.push(e.slice(s));break}let n=t[r].split(":");this.headers[n[0].trim()]=isNaN(parseInt(n[1].trim()))?n[1].trim():parseInt(n[1].trim()),r==t.length&&(s=!0)}return!s}getRaw(){if(this.body&&this.done)return this.body;throw"HEAD"==this.method?new Error("This function is not supported in HEAD method"):new Error("Response not finished")}getText(e="ascii"){return this.getRaw().toString(e)}}class f extends d.default{constructor(e,t){if(super(),this.connected=!1,this.headers={},this.timeout=5e3,this.urlObj=new c.default.URL(e),this.port=Number(this.urlObj.port)||"https:"===this.urlObj.protocol?443:80,!this.urlObj.hostname)throw new Error("Invalid URL");this.host=this.urlObj.hostname,this.socket=new o.default.Socket,this.setHeader("Host",this.urlObj.hostname),this.socket.on("error",(e=>{throw e})),this.socket.on("close",(()=>this.connected=!1)),t&&(this.timeout=t.timeout||this.timeout)}connect(){return new Promise(((e,t)=>{try{if(this.connected&&e(!0),"https:"===this.urlObj.protocol){const e=h.default.createSecureContext({maxVersion:"TLSv1.3",minVersion:"TLSv1.2"});this.socket=h.default.connect(this.port,this.host,{rejectUnauthorized:!1,servername:this.host,secureContext:e},(()=>{}))}else this.socket.connect(this.port,this.host);this.socket.once("connect",(()=>{this.connected=!0,e(!0)}))}catch(e){console.error(e),t(e)}}))}disconnect(){return new Promise(((e,t)=>{try{this.connected&&e(!0),this.socket.connect(this.port,this.host),this.socket.once("close",(()=>{this.connected=!1,e(!0)}))}catch(e){t(e)}}))}formatRequest(e,t,s,r){let n=`${e} ${t} HTTP/1.1\r\n`;for(let e in s)n+=`${e}: ${s[e]}\r\n`;return n+="\r\n",r&&(n+=r),n}setHeader(e,t){this.headers[e]=t}removeHeader(e){delete this.headers[e]}send(e){if(!this.connected)throw new Error("Not connected");try{this.socket.write(e)}catch(e){throw e}}recive(e){return new Promise(((t,s)=>{let r=new a(e);this.socket.on("data",(e=>{this.emit("data",e),r.write(e)&&(this.socket.removeAllListeners("data"),t(r))})),setTimeout((()=>{r.headers["Content-Length"]||t(r)}),this.timeout)}))}}e.HTTPClient=class extends f{constructor(e,t){super(e,t)}get(e){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");console.log("sending request");let t=this.formatRequest("GET",e,this.headers);this.send(Buffer.from(t,"ascii"));return yield this.recive("GET")}))}post(e,t){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("POST",e,this.headers,t);this.send(Buffer.from(s,"ascii"));return yield this.recive("POST")}))}put(e,t){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("PUT",e,this.headers,t);this.send(Buffer.from(s,"ascii"));return yield this.recive("PUT")}))}delete(e,t){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("DELETE",e,this.headers,t);this.send(Buffer.from(s,"ascii"));return yield this.recive("DELETE")}))}head(e){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let t=this.formatRequest("HEAD",e,this.headers);this.send(Buffer.from(t,"ascii"));return yield this.recive("HEAD")}))}patch(e,t){return u(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");let s=this.formatRequest("PATCH",e,this.headers,t);this.send(Buffer.from(s,"ascii"));return yield this.recive("PATCH")}))}},e.HTTPConnection=f,e.response=a,Object.defineProperty(e,"__esModule",{value:!0})}));
