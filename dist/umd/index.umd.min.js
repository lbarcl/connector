!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("net"),require("tls"),require("url")):"function"==typeof define&&define.amd?define(["exports","net","tls","url"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Connector={},t.net,t.tls,t.url)}(this,(function(t,e,n,s){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=r(e),i=r(n),h=r(s);function c(t,e,n,s){return new(n||(n=Promise))((function(r,o){function i(t){try{c(s.next(t))}catch(t){o(t)}}function h(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,h)}c((s=s.apply(t,e||[])).next())}))}class a{constructor(){this.body=null,this.data=[],this.done=!1,this.headerDone=!1,this.statusCode=200,this.headers={}}write(t){if(this.done)throw new Error("Response already finished");if(this.headerDone){this.data.push(t);let n=0;for(let t=0;t<this.data.length;t++)n+=this.data[t].length;e(n,this)}else this.parseHeader(t)&&(this.headerDone=!0,e(this.data[0].length,this));function e(t,e){return t>=e.headers["Content-Length"]&&(e.body=Buffer.concat(e.data),e.data=[],e.done=!0),e.done}return this.done}parseHeader(t){let e=t.toString("ascii").split("\r\n"),n=!1,s=e[0].split(" ");this.statusCode=Number(s[1]);for(let s=1;s<e.length;s++){if(!e[s]||"\r\n"==e[s]){const n=Buffer.from(e.slice(0,s).join("\r\n")+"\r\n","ascii").length;this.headers["Content-Length"]?this.data.push(t.slice(n+2,n+this.headers["Content-Length"])):this.data.push(t.slice(n));break}let r=e[s].split(":");this.headers[r[0].trim()]=isNaN(parseInt(r[1].trim()))?r[1].trim():parseInt(r[1].trim()),s==e.length&&(n=!0)}return!n}getRaw(){if(this.body&&this.done)return this.body;throw new Error("Response not finished")}getText(t="ascii"){return c(this,void 0,void 0,(function*(){return this.getRaw().toString(t)}))}}t.connection=class{constructor(t){if(this.connected=!1,this.headers={},this.urlObj=new h.default.URL(t),this.port=Number(this.urlObj.port)||"https:"===this.urlObj.protocol?443:80,!this.urlObj.hostname)throw new Error("Invalid URL");this.host=this.urlObj.hostname,this.socket=new o.default.Socket,this.setHeader("Host",this.urlObj.hostname),this.socket.on("error",(t=>{throw t})),this.socket.on("close",(()=>this.connected=!1))}connect(){return new Promise(((t,e)=>{try{if(this.connected&&t(!0),"https:"===this.urlObj.protocol){const t=i.default.createSecureContext({maxVersion:"TLSv1.3",minVersion:"TLSv1.2"});this.socket=i.default.connect(this.port,this.host,{rejectUnauthorized:!1,servername:this.host,secureContext:t},(()=>{}))}else this.socket.connect(this.port,this.host);this.socket.once("connect",(()=>{this.connected=!0,t(!0)}))}catch(t){console.error(t),e(t)}}))}disconnect(){return new Promise(((t,e)=>{try{this.connected&&t(!0),this.socket.connect(this.port,this.host),this.socket.once("close",(()=>{this.connected=!1,t(!0)}))}catch(t){e(t)}}))}formatRequest(t,e,n,s){let r=`${t} ${e} HTTP/1.1\r\n`;for(let t in n)r+=`${t}: ${n[t]}\r\n`;return r+="\r\n",s&&(r+=s),r}setHeader(t,e){this.headers[t]=e}removeHeader(t){delete this.headers[t]}send(t){if(!this.connected)throw new Error("Not connected");try{this.socket.write(t)}catch(t){throw t}}recive(){return new Promise(((t,e)=>{let n=new a,s=!1;this.socket.on("data",(e=>{console.log("reciving"),s||n.write(e)&&(s=!0,t(n))}))}))}get(t){return c(this,void 0,void 0,(function*(){if(!this.connected)throw new Error("Must be connected to send request");console.log("sending request");let e=this.formatRequest("GET",t,this.headers);this.send(Buffer.from(e,"ascii"));return yield this.recive()}))}},t.response=a,Object.defineProperty(t,"__esModule",{value:!0})}));
